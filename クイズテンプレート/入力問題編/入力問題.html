<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ここがヘッダだよ</title>           <!--ヘッダ名を設定-->
  <link rel="stylesheet" href="../keep_out/style2.css">
  <audio id="se-correct" src="../keep_out/correct.mp3" preload="auto"></audio>
  <audio id="se-wrong" src="../keep_out/wrong.mp3" preload="auto"></audio>
</head>
<body>
  <audio id="bgm" src="../keep_out/BGM.mp3" loop></audio>
  <button id="bgm-toggle">▶️ BGMを再生</button>
  <div class="quiz-container" id="home">
    <h1>タイトル</h1>  <!--タイトルを設定(ヘッダ名と同じでも可)-->
    <p>全5問です。</p>
    <button onclick="startQuiz()">開始</button>
    <a href="a.html" class="back-button">問題選択に戻る</a> <!--a.htmlを変更(問題選択画面のファイル名にする)-->
  </div>

  <div class="quiz-container" id="quiz" style="display: none;"></div>

  <script>
  const questions = [
/*
  {
  q: "次のコードの出力を半角の空白区切りで入力してください。<pre>map&lt;string, int&gt; mp;\nmp[\"a\"]++;\nmp[\"b\"] += 3;\ncout << mp[\"a\"] << \" \" << mp[\"b\"] << \" \" << mp[\"c\"] << endl;</pre>",
  answer: "1 3 0",
  explanation: "mp[\"a\"]++ で a = 1、mp[\"b\"] += 3 で b = 3。<br>存在しないキー \"c\" にアクセスすると map は初期値 0 を挿入して返すため、出力は 1 3 0 になる。"
},

  {
  q: "次のコードの出力は?\n<pre>priority_queue&lt;int&gt; pq;\npq.push(3);\npq.push(5);\npq.push(1);\ncout << pq.top() << endl;</pre>",
  answer: "5",
  explanation: "priority_queueはデフォルトで大きい順（最大ヒープ）に並ぶため、top()は最大値の5となる。"
},

{
  q: "次のコードの出力は?\n<pre>vector&lt;pair&lt;int, int&gt;&gt; v(4);\nv[0] = {1, 3};\nv[1] = {2, 1};\nv[2] = {2, 0};\nv[3] = {1, 2};\nsort(v.begin(), v.end());\nfor (auto [a, b] : v) cout << a << \" \" << b << endl;</pre>",
  answer: "1 2\n1 3\n2 0\n2 1",
  explanation: "pairのソートは辞書順（firstが小さい順、同じならsecondが小さい順）。<br>よって順番は {1,2}, {1,3}, {2,0}, {2,1} となる。"
},

{
  q: "次のコードの出力を1行で入力してください。\n<pre>int a = 10;\nint* p = &a;\n*p += 5;\ncout << a << endl;\na += 5; cout << *p << endl;</pre>",
  answer: "15\n20",
  explanation: "ポインタpはaのアドレスを指しており、*p += 5 は a に5を加える操作。<br>したがって a は10 → 15となる。<br>その後 a += 5 で a は20になるが、*p はaのアドレスを指しているので、*pも20になる。"
},

{
        q: `次のコードの出力を1行で入力してください。<pre>template &lt;typename T&gt;
T mul(T x, T y) {
  return x * y;
}

cout << mul(2, 4) << endl;
cout << mul(1.5, 2.0) << endl;</pre>`,
        answer: "8\n3.0",
        explanation: "テンプレート関数により型Tに応じて演算される。2 * 4 = 8、1.5 * 2.0 = 3.0"
      },
      */
];

    let current = 0;
    let score = 0;
    let backClickCount = 0;

     function escapeHTMLExceptBR(str) {
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/&lt;br&gt;/g, "<br>");
}

    const backButtonHome = document.querySelector(".back-button");
if (backButtonHome) {
  backButtonHome.addEventListener("click", function(e) {
    e.preventDefault();
    if (backClickCount === 0) {
      alert("本当に戻りますか？もう一度クリックすると戻ります。");
      backClickCount++;
    } else {
      window.location.href = "a.html";  // a.htmlを変更(問題選択画面のファイル名にする)
    }
  });
}



    function startQuiz() {
      if(!bgm.paused){
      document.getElementById('bgm').play();
      bgmToggleBtn.textContent = '⏸️ BGMを停止';
      }
      current = 0;
      document.getElementById("home").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      showQuestion(current);
    }

    function showQuestion(index) {
      const q = questions[index];

      const container = document.getElementById("quiz");
      container.innerHTML = "";

      const question = document.createElement("div");
      question.innerHTML = `<strong>Q${index + 1}:</strong> ${escapeHTMLExceptBR(q.q)}`;

      container.appendChild(question);

      const input = document.createElement("textarea");
      input.placeholder = "ここに入力してください";
      container.appendChild(input);

      const answerButton = document.createElement("button");
      answerButton.textContent = "解答する";
      container.appendChild(answerButton);

      const result = document.createElement("div");
      result.className = "result";
      container.appendChild(result);

      const explanation = document.createElement("div");
      explanation.className = "explanation";
      container.appendChild(explanation);

      const nextButton = document.createElement("button");
      nextButton.textContent = "次へ";
      nextButton.style.display = "none";
      container.appendChild(nextButton);

      const backButton = document.createElement("a");
      backButton.href = "a.html"; // a.htmlを変更(問題選択画面のファイル名にする)
      backButton.textContent = "問題選択に戻る";
      backButton.className = "home-button";
      container.appendChild(backButton);
      backButton.addEventListener("click", function(e) {
  e.preventDefault();
  if (backClickCount === 0) {
    alert("本当に戻りますか？もう一度クリックすると戻ります。");
    backClickCount++;
  } else {
    window.location.href = "a.html"; // a.htmlを変更(問題選択画面のファイル名にする)
  }
});


    let emptyClickCount = 0;

    answerButton.addEventListener("click", () => {
    const userInput = input.value.trim();

  if (userInput === "") {
    emptyClickCount++;
    if (emptyClickCount === 1) {
      result.textContent = "何も入力されていません。もう一度押すと正解が表示されます。";
      result.style.color = "black";
      return;
    }
  }

  input.disabled = true;

  const seCorrect = document.getElementById("se-correct");
  const seWrong = document.getElementById("se-wrong");


  if (userInput === q.answer) {
    score++;
    seCorrect.currentTime = 0;
  seCorrect.play();
  result.textContent = "○ 正解です！";
  result.style.color = "green";
  explanation.innerHTML = escapeHTMLExceptBR(q.explanation);

} else {
  seCorrect.currentTime = 0;
  seCorrect.play();
  result.innerHTML = `× 不正解です。<br><strong>正解：</strong><pre>${q.answer}</pre>`;
  result.style.color = "red";
  explanation.innerHTML = escapeHTMLExceptBR(q.explanation);

}

  answerButton.style.display = "none";
  nextButton.style.display = "block";
});


   nextButton.addEventListener("click", () => {
    setTimeout(() => {
    current++;
    backClickCount = 0;
    if (current < questions.length) {
      showQuestion(current);
    } else {
      container.innerHTML = `<h2>お疲れ様でした！全${questions.length}問が終了しました。<br><br>${score}問正解しました！</h2>`;
      const backBtn = document.createElement("a");
      backBtn.href = "a.html"; // a.htmlを変更(問題選択画面のファイル名にする)
      backBtn.textContent = "問題選択に戻る";
      backBtn.className = "home-button";
      container.appendChild(backBtn);
    }
  }, 100);
  });


    }
  const bgm = document.getElementById('bgm');
  const bgmToggleBtn = document.getElementById('bgm-toggle');

  bgmToggleBtn.addEventListener('click', () => {
    if (!bgm.paused) {
      bgm.pause();
      bgmToggleBtn.textContent = '▶️ BGMを再開';
    } else {
      bgm.play();
      bgmToggleBtn.textContent = '⏸️ BGMを停止';
  }
});

  </script>
</body>
</html>
